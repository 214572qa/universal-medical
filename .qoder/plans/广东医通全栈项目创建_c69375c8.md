# 广东医通全栈项目创建计划

## 一、项目概述

- **项目名称**：广东医通（gdyt）
- **项目路径**：`d:\test\local-rep-1\gdyt`（执行时确认）
- **技术栈**：
  - 前端：Nuxt 3 + Vue 3 + TypeScript + Element Plus
  - 后端：Nuxt Server Routes (API)
  - 数据库：MySQL + Prisma ORM
- **核心原则**：代码语义化、中文注释、简洁易读

---

## 二、项目结构设计

```
gdyt/
├── assets/                    # 静态资源（图片、字体等）
├── components/                # 可复用组件
│   ├── common/               # 通用组件（头部、底部等）
│   └── business/             # 业务组件（登录、就诊人等）
├── composables/               # 组合式函数
│   ├── useAuth.ts            # 认证相关
│   └── useHospital.ts        # 医院相关
├── layouts/                   # 布局组件
│   └── default.vue           # 默认布局
├── pages/                     # 页面（自动生成路由）
│   ├── index.vue             # 首页
│   ├── hospital/             # 医院模块
│   └── user/                 # 用户中心
├── server/                    # 后端代码
│   ├── api/                  # API接口
│   │   ├── hospital/         # 医院相关接口
│   │   ├── user/             # 用户相关接口
│   │   └── order/            # 订单相关接口
│   ├── middleware/           # 中间件（认证等）
│   └── utils/                # 工具函数
├── prisma/                    # 数据库
│   └── schema.prisma         # 数据模型
├── types/                     # 类型定义
├── nuxt.config.ts            # Nuxt配置
└── README.md                 # 项目文档
```

---

## 三、实施步骤

### 阶段一：项目初始化（步骤 1-4）

**1. 初始化 Nuxt 3 项目**
```bash
npx nuxi@latest init gdyt
cd gdyt
```

**2. 安装核心依赖**
```bash
# UI框架
npm install element-plus @element-plus/icons-vue

# 数据库
npm install prisma @prisma/client

# 工具库
npm install -D sass
```

**3. 配置 nuxt.config.ts**
- 配置 Element Plus 自动导入
- 配置路径别名
- 配置 CSS 预处理器

**4. 初始化 Prisma**
```bash
npx prisma init
```
配置 MySQL 连接

---

### 阶段二：数据库设计（步骤 5）

**5. 创建 Prisma Schema** (`prisma/schema.prisma`)

核心数据表：
| 表名 | 说明 | 主要字段 |
|------|------|----------|
| User | 用户表 | id, phone, name, token |
| Hospital | 医院表 | id, hoscode, hosname, hostype, intro |
| Department | 科室表 | id, hoscode, depcode, depname, parentId |
| Schedule | 排班表 | id, hoscode, depcode, doctorId, workDate |
| Patient | 就诊人表 | id, userId, name, idCard, phone |
| Order | 订单表 | id, userId, scheduleId, patientId, status |

---

### 阶段三：后端 API 开发（步骤 6-10）

**6. 创建认证中间件** (`server/middleware/auth.ts`)
- JWT Token 验证
- 用户身份识别

**7. 医院模块 API** (`server/api/hospital/`)
| 接口 | 方法 | 说明 |
|------|------|------|
| /api/hospital/list | GET | 获取医院列表 |
| /api/hospital/[hoscode] | GET | 获取医院详情 |
| /api/hospital/[hoscode]/departments | GET | 获取科室列表 |
| /api/hospital/schedule | GET | 获取排班数据 |
| /api/hospital/doctors | GET | 获取医生列表 |

**8. 用户模块 API** (`server/api/user/`)
| 接口 | 方法 | 说明 |
|------|------|------|
| /api/user/sendCode | POST | 发送验证码 |
| /api/user/login | POST | 用户登录 |
| /api/user/info | GET | 获取用户信息 |
| /api/user/certification | POST | 实名认证 |

**9. 就诊人模块 API** (`server/api/patient/`)
| 接口 | 方法 | 说明 |
|------|------|------|
| /api/patient/list | GET | 获取就诊人列表 |
| /api/patient/add | POST | 新增就诊人 |
| /api/patient/update | PUT | 更新就诊人 |
| /api/patient/[id] | DELETE | 删除就诊人 |

**10. 订单模块 API** (`server/api/order/`)
| 接口 | 方法 | 说明 |
|------|------|------|
| /api/order/submit | POST | 提交订单 |
| /api/order/[id] | GET | 订单详情 |
| /api/order/list | GET | 订单列表 |
| /api/order/cancel | PUT | 取消订单 |

---

### 阶段四：前端页面开发（步骤 11-16）

**11. 布局和通用组件**
- `layouts/default.vue` - 默认布局（头部+底部）
- `components/common/AppHeader.vue` - 顶部导航
- `components/common/AppFooter.vue` - 底部信息
- `components/business/LoginDialog.vue` - 登录弹窗

**12. 首页模块** (`pages/index.vue`)
- 轮播图展示
- 医院搜索
- 等级/地区筛选
- 医院列表卡片

**13. 医院模块** (`pages/hospital/`)
- `[hoscode].vue` - 医院详情（嵌套路由）
- `[hoscode]/register.vue` - 预约挂号入口
- `[hoscode]/register/step1.vue` - 选择科室和日期
- `[hoscode]/register/step2.vue` - 选择就诊人并确认

**14. 用户中心** (`pages/user/`)
- `index.vue` - 用户中心首页
- `certification.vue` - 实名认证
- `patient.vue` - 就诊人管理
- `orders.vue` - 订单列表
- `orders/[id].vue` - 订单详情

**15. 组合式函数** (`composables/`)
- `useAuth.ts` - 登录状态、Token管理
- `useHospital.ts` - 医院数据获取
- `usePatient.ts` - 就诊人管理
- `useOrder.ts` - 订单操作

**16. 全局状态管理**
- 使用 Nuxt 内置的 `useState` 或 Pinia
- 用户信息状态
- 医院详情缓存

---

### 阶段五：文档和收尾（步骤 17-18）

**17. 创建 README.md**

内容结构：
```markdown
# 广东医通 - 医疗预约挂号系统

## 项目简介
## 主要功能
## 技术架构
## 业务流程图
## 快速开始
  - 环境要求
  - 安装步骤
  - 数据库配置
  - 启动项目
## 项目结构
## API文档
## 开发指南
```

**18. 代码质量检查**
- 确保所有函数有中文注释
- 变量命名语义化
- 移除调试代码

---

## 四、代码规范示例

### API 函数注释规范
```typescript
/**
 * 获取医院详情信息
 * 
 * @description 根据医院编码查询医院的完整信息，包括基本信息、预约规则等
 * @param hoscode - 医院唯一编码，如 "1000_0"
 * @returns 返回医院详情对象，包含医院名称、等级、地址、简介等
 */
export async function getHospitalDetail(hoscode: string) {
  // 从数据库查询医院信息
  const hospital = await prisma.hospital.findUnique({
    where: { hoscode }
  })
  return hospital
}
```

### 组件逻辑注释规范
```vue
<script setup lang="ts">
/**
 * 医院等级筛选组件
 * 
 * 功能说明：
 * - 展示所有可选的医院等级（三级甲等、三级乙等等）
 * - 用户点击某个等级后，高亮显示并通知父组件进行筛选
 * - 支持"全部"选项重置筛选条件
 */

// 当前选中的等级，默认为空表示"全部"
const selectedLevel = ref('')

// 定义向父组件发送的事件
const emit = defineEmits<{
  // 等级变化事件，参数为选中的等级代码
  levelChange: [level: string]
}>()

/**
 * 处理等级选择
 * 当用户点击某个等级按钮时触发
 * @param level - 选中的等级代码，空字符串表示"全部"
 */
function handleLevelClick(level: string) {
  // 更新当前选中状态
  selectedLevel.value = level
  // 通知父组件筛选条件已改变
  emit('levelChange', level)
}
</script>
```

---

## 五、任务清单（执行时使用）

| ID | 任务 | 优先级 |
|----|------|--------|
| p1 | 初始化 Nuxt 3 项目并安装依赖 | P0 |
| p2 | 配置 nuxt.config.ts 和 Element Plus | P0 |
| p3 | 创建 Prisma Schema 数据模型 | P0 |
| p4 | 实现后端认证中间件 | P0 |
| p5 | 实现医院模块 API | P1 |
| p6 | 实现用户模块 API | P1 |
| p7 | 实现就诊人模块 API | P1 |
| p8 | 实现订单模块 API | P1 |
| p9 | 创建布局和通用组件 | P1 |
| p10 | 实现首页模块 | P1 |
| p11 | 实现医院详情和预约流程页面 | P1 |
| p12 | 实现用户中心页面 | P1 |
| p13 | 创建组合式函数 | P2 |
| p14 | 编写 README.md 文档 | P2 |
| p15 | 代码质量检查和注释完善 | P2 |

---

## 六、注意事项

1. **前端安全策略**：Token 直接存储在 localStorage，不做混淆加密
2. **后端安全策略**：所有敏感操作在 API 层进行身份验证和权限检查
3. **注释语言**：所有注释使用中文
4. **命名规范**：变量和函数使用语义化命名（如 `hospitalList` 而非 `list`）